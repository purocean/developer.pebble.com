<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Event Services // Pebble Developers</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="How to use the various asynchronous event services to power app features.
">
  <link rel="canonical" href="http://developer.getpebble.com/guides/events-and-services/events/">
  <link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,400,300,600,700" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet" type="text/css">
  <link href="/developer.pebble.com/assets/favicon.png" rel="shortcut icon" type="image/vnd.microsoft.icon" id="favicon">
  <link rel="stylesheet" type="text/css" href="/developer.pebble.com/assets/css/main.css">

  <noscript>
  <link rel="stylesheet" type="text/css" href="/developer.pebble.com/assets/css/noscript.css">
  </noscript>

  <script type="text/javascript" >
    var _rollbarConfig = {
      accessToken: 'e1ecd52de5ba46c88e9f6f346a954c62',
      captureUncaught: true,
      payload: {
        environment: 'production'
      }
    };
    !function(a,b){function c(b){this.shimId=++h,this.notifier=null,this.parentShim=b,this.logger=function(){},a.console&&void 0===a.console.shimId&&(this.logger=a.console.log)}function d(b,c,d){a._rollbarWrappedError&&(d[4]||(d[4]=a._rollbarWrappedError),d[5]||(d[5]=a._rollbarWrappedError._rollbarContext),a._rollbarWrappedError=null),b.uncaughtError.apply(b,d),c&&c.apply(a,d)}function e(b){var d=c;return g(function(){if(this.notifier)return this.notifier[b].apply(this.notifier,arguments);var c=this,e="scope"===b;e&&(c=new d(this));var f=Array.prototype.slice.call(arguments,0),g={shim:c,method:b,args:f,ts:new Date};return a._rollbarShimQueue.push(g),e?c:void 0})}function f(a,b){if(b.hasOwnProperty&&b.hasOwnProperty("addEventListener")){var c=b.addEventListener;b.addEventListener=function(b,d,e){c.call(this,b,a.wrap(d),e)};var d=b.removeEventListener;b.removeEventListener=function(a,b,c){d.call(this,a,b&&b._wrapped?b._wrapped:b,c)}}}function g(a,b){return b=b||this.logger,function(){try{return a.apply(this,arguments)}catch(c){b("Rollbar internal error:",c)}}}var h=0;c.init=function(a,b){var e=b.globalAlias||"Rollbar";if("object"==typeof a[e])return a[e];a._rollbarShimQueue=[],a._rollbarWrappedError=null,b=b||{};var h=new c;return g(function(){if(h.configure(b),b.captureUncaught){var c=a.onerror;a.onerror=function(){var a=Array.prototype.slice.call(arguments,0);d(h,c,a)};var g,i,j="EventTarget,Window,Node,ApplicationCache,AudioTrackList,ChannelMergerNode,CryptoOperation,EventSource,FileReader,HTMLUnknownElement,IDBDatabase,IDBRequest,IDBTransaction,KeyOperation,MediaController,MessagePort,ModalWindow,Notification,SVGElementInstance,Screen,TextTrack,TextTrackCue,TextTrackList,WebSocket,WebSocketWorker,Worker,XMLHttpRequest,XMLHttpRequestEventTarget,XMLHttpRequestUpload".split(",");for(g=0;g<j.length;++g)i=j[g],a[i]&&a[i].prototype&&f(h,a[i].prototype)}return a[e]=h,h},h.logger)()},c.prototype.loadFull=function(a,b,c,d,e){var f=g(function(){var a=b.createElement("script"),e=b.getElementsByTagName("script")[0];a.src=d.rollbarJsUrl,a.async=!c,a.onload=h,e.parentNode.insertBefore(a,e)},this.logger),h=g(function(){var b;if(void 0===a._rollbarPayloadQueue){var c,d,f,g;for(b=new Error("rollbar.js did not load");c=a._rollbarShimQueue.shift();)for(f=c.args,g=0;g<f.length;++g)if(d=f[g],"function"==typeof d){d(b);break}}"function"==typeof e&&e(b)},this.logger);g(function(){c?f():a.addEventListener?a.addEventListener("load",f,!1):a.attachEvent("onload",f)},this.logger)()},c.prototype.wrap=function(b,c){try{var d;if(d="function"==typeof c?c:function(){return c||{}},"function"!=typeof b)return b;if(b._isWrap)return b;if(!b._wrapped){b._wrapped=function(){try{return b.apply(this,arguments)}catch(c){throw c._rollbarContext=d(),c._rollbarContext._wrappedSource=b.toString(),a._rollbarWrappedError=c,c}},b._wrapped._isWrap=!0;for(var e in b)b.hasOwnProperty(e)&&(b._wrapped[e]=b[e])}return b._wrapped}catch(f){return b}};for(var i="log,debug,info,warn,warning,error,critical,global,configure,scope,uncaughtError".split(","),j=0;j<i.length;++j)c.prototype[i[j]]=e(i[j]);var k="//d37gvrvc0wt4s1.cloudfront.net/js/v1.1/rollbar.min.js";_rollbarConfig.rollbarJsUrl=_rollbarConfig.rollbarJsUrl||k;var l=c.init(a,_rollbarConfig);l.loadFull(a,b,!1,_rollbarConfig)}(window,document);
  </script>
  <script type="text/javascript" async>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-30638158-4', 'auto');
    ga('send', 'pageview');
  </script>

</head>
<body class="">
  <div class="mmenu__wrapper">
    <div class="sidebar__wrapper sidebar__wrapper--sectionmenu">
  <div class="sidebar sidebar--narrow">
    <a href="/" class="sidebar__header">
      <span>pebble</span>
    </a>
    <ul class="mainmenu">
      <li class="mainmenu__item mainmenu__item--getting-started"><a href="/tutorials/"><span>Tutorials</span></a></li>
<li class="mainmenu__item mainmenu__item--sdk"><a href="/sdk/"><span>Get the SDK</span></a></li>
<li class="mainmenu__item mainmenu__item--guides active"><a href="/guides/"><span>Guides</span></a></li>
<li class="mainmenu__item mainmenu__item--docs"><a href="/docs/"><span>Documentation</span></a></li>
<li class="mainmenu__item mainmenu__item--examples"><a href="/examples/"><span>Examples</span></a></li>
<li class="mainmenu__item mainmenu__item--community"><a href="/community/"><span>Community</span></a></li>
<li class="mainmenu__item mainmenu__item--blog"><a href="/blog/"><span>Blog</span></a></li>
<li class="mainmenu__item mainmenu__item--more"><a href="/more/"><span>More</span></a></li>

    </ul>
    <div class="sidebar__legal">
      <a href="https://www.pebble.com/legal/privacy/" target="_blank">Privacy</a>
      <br>
      <a href="https://www.pebble.com/legal/cookies/" target="_blank">Cookies</a>
    </div>
    <a href="https://dev-portal.getpebble.com/" target="_blank" class="sidebar__footer">Publish</a>
  </div>
  <div class="section-menu section-menu--guides section-menu--light">
    <div class="section-menu__header">
      <h3><a href="/guides/">Guides</a></h3>
    </div>
    <ul>
      <li class="section-menu__item">
        <a href="/guides/toc/">Table of Contents</a>
      </li>




        <li class="section-menu__item">
          <a href="/guides/app-resources/">

            App Resources
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/appstore-publishing/">

            Appstore Publishing
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/best-practices/">

            Best Practices
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/communication/">

            Communication
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/debugging/">

            Debugging
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/design-and-interaction/">

            Design and Interaction
          </a>

        </li>




        <li class="section-menu__item open">
          <a href="/guides/events-and-services/">

            Events and Services
          </a>

            <ul>




                <li class="section-menu__subitem">
                  <a href="/guides/events-and-services/accelerometer/"><span>Accelerometer</span></a>
                </li>



                <li class="section-menu__subitem">
                  <a href="/guides/events-and-services/background-worker/"><span>Background Worker</span></a>
                </li>



                <li class="section-menu__subitem">
                  <a href="/guides/events-and-services/buttons/"><span>Buttons</span></a>
                </li>



                <li class="section-menu__subitem">
                  <a href="/guides/events-and-services/compass/"><span>Compass</span></a>
                </li>



                <li class="section-menu__subitem">
                  <a href="/guides/events-and-services/dictation/"><span>Dictation</span></a>
                </li>



                <li class="section-menu__subitem active">
                  <a href="/guides/events-and-services/events/"><span>Event Services</span></a>
                </li>





                <li class="section-menu__subitem">
                  <a href="/guides/events-and-services/hrm/"><span>Heart Rate Monitor</span></a>
                </li>



                <li class="section-menu__subitem">
                  <a href="/guides/events-and-services/health/"><span>Pebble Health</span></a>
                </li>



                <li class="section-menu__subitem">
                  <a href="/guides/events-and-services/persistent-storage/"><span>Persistent Storage</span></a>
                </li>



                <li class="section-menu__subitem">
                  <a href="/guides/events-and-services/wakeups/"><span>Wakeups</span></a>
                </li>



            </ul>

        </li>




        <li class="section-menu__item">
          <a href="/guides/graphics-and-animations/">

            Graphics and Animations
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/migration/">

            Migrating Older Apps
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/pebble-packages/">

            Pebble Packages
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/pebble-timeline/">

            Pebble Timeline
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/rocky-js/">

            Rocky.js
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/smartstraps/">

            Smartstraps
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/tools-and-resources/">

            Tools and Resources
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/user-interfaces/">

            User Interfaces
          </a>

        </li>

    </ul>
  </div>
</div><!-- sidebar__wrapper -->
<div class="content content--section-menu">
  <div class="search">
  <a  href="javascript:void(0);" class="mobile-nav__hamburger js-mobile-nav-toggle"><i class="fa fa-reorder"></i></a>
  <i class="fa fa-lg fa-search search__icon"></i><input type="search" id="quicksearch" placeholder="Search Developer Site">
</div>
<div class="quicksearch" style="display: none;" id="quicksearch__results"></div>
<div id="search__blackout" style="display: none;"></div>

  <div class="container">

<div class="visible-m visible-s visible-xs row">
  <div class="col-xs-12">
    <div class="form__group">
      <div class="select-style no-label">
        <select class="js-toc-select">

            <option value="types-of-events">Types of Events</option>

            <option value="using-event-services">Using Event Services</option>

            <option value="tick-timer-service">- Tick Timer Service</option>

            <option value="connection-service">- Connection Service</option>

            <option value="accelerometer-service">- Accelerometer Service</option>

            <option value="battery-state-service">- Battery State Service</option>

            <option value="health-service">- Health Service</option>

            <option value="app-focus-service">- App Focus Service</option>

            <option value="compass-service">- Compass Service</option>

        </select>
      </div>
    </div>
  </div>
</div>


<div class="row">
  <div class="col-l-8 col-m-12">
    <h1 class="pagetitle">Event Services</h1>

<!--

 -->
    <div class="markdown markdown--staff">

    <p>All Pebble apps are executed in three phases, which are summarized below:</p>
<ul>
<li><p>Initialization - all code from the beginning of <code>main()</code> is run to set up all
the components of the app.</p></li>
<li><p>Event Loop - the app waits for and responds to any event services it has
subscribed to.</p></li>
<li><p>Deinitialization - when the app is exiting (i.e.: the user has pressed Back
from the last <a href="/docs/c/User_Interface/Window/" title="Window" class="link--docs"><code>Window</code></a> in the stack) <a href="/docs/c/Foundation/App/#app_event_loop" title="app_event_loop" class="link--docs"><code>app_event_loop()</code></a> returns, and all
deinitialization code is run before the app exits.</p></li>
</ul>
<p>Once <a href="/docs/c/Foundation/App/#app_event_loop" title="app_event_loop" class="link--docs"><code>app_event_loop()</code></a> is called, execution of <code>main()</code> pauses and all
further activities are performed when events from various <a href="/docs/c/Foundation/Event_Service/" title="Event Service" class="link--docs"><code>Event Service</code></a>
types occur. This continues until the app is exiting, and is typically handled
in the following pattern:</p><div class="highlight"><pre><span class="k">static</span> <span class="kt">void</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Initialization code here</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">deinit</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Deinitialization code here</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">init</span><span class="p">();</span>
  <span class="n">app_event_loop</span><span class="p">();</span>
  <span class="n">deinit</span><span class="p">();</span>
<span class="p">}</span>
</pre></div><h2 id="types-of-events" class="anchor">Types of Events</h2><p>There are multiple types of events an app can receive from various event
services. These are described in the table below, along with their handler
signature and a brief description of what they do:</p>
<table><thead>
<tr>
<th>Event Service</th>
<th>Handler(s)</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="/docs/c/Foundation/Event_Service/TickTimerService/" title="TickTimerService" class="link--docs"><code>TickTimerService</code></a></td>
<td><a href="/docs/c/Foundation/Event_Service/TickTimerService/#TickHandler" title="TickHandler" class="link--docs"><code>TickHandler</code></a></td>
<td>Most useful for watchfaces. Allows apps to be notified when a second, minute, hour, day, month or year ticks by.</td>
</tr>
<tr>
<td><a href="/docs/c/Foundation/Event_Service/ConnectionService/" title="ConnectionService" class="link--docs"><code>ConnectionService</code></a></td>
<td><a href="/docs/c/Foundation/Event_Service/ConnectionService/#ConnectionHandler" title="ConnectionHandler" class="link--docs"><code>ConnectionHandler</code></a></td>
<td>Allows apps to know when the Bluetooth connection with the phone connects and disconnects.</td>
</tr>
<tr>
<td><a href="/docs/c/Foundation/Event_Service/AccelerometerService/" title="AccelerometerService" class="link--docs"><code>AccelerometerService</code></a></td>
<td><a href="/docs/c/Foundation/Event_Service/AccelerometerService/#AccelDataHandler" title="AccelDataHandler" class="link--docs"><code>AccelDataHandler</code></a><br/><a href="/docs/c/Foundation/Event_Service/AccelerometerService/#AccelTapHandler" title="AccelTapHandler" class="link--docs"><code>AccelTapHandler</code></a></td>
<td>Allows apps to receive raw data or tap events from the onboard accelerometer.</td>
</tr>
<tr>
<td><a href="/docs/c/Foundation/Event_Service/BatteryStateService/" title="BatteryStateService" class="link--docs"><code>BatteryStateService</code></a></td>
<td><a href="/docs/c/Foundation/Event_Service/BatteryStateService/#BatteryStateHandler" title="BatteryStateHandler" class="link--docs"><code>BatteryStateHandler</code></a></td>
<td>Allows apps to read the state of the battery, as well as whether the watch is plugged in and charging.</td>
</tr>
<tr>
<td><a href="/docs/c/Foundation/Event_Service/HealthService/" title="HealthService" class="link--docs"><code>HealthService</code></a></td>
<td><a href="/docs/c/Foundation/Event_Service/HealthService/#HealthEventHandler" title="HealthEventHandler" class="link--docs"><code>HealthEventHandler</code></a></td>
<td>Allows apps to be notified to changes in various <a href="/docs/c/Foundation/Event_Service/HealthService/#HealthMetric" title="HealthMetric" class="link--docs"><code>HealthMetric</code></a> values as the user performs physical activities.</td>
</tr>
<tr>
<td><a href="/docs/c/Foundation/Event_Service/AppFocusService/" title="AppFocusService" class="link--docs"><code>AppFocusService</code></a></td>
<td><a href="/docs/c/Foundation/Event_Service/AppFocusService/#AppFocusHandler" title="AppFocusHandler" class="link--docs"><code>AppFocusHandler</code></a></td>
<td>Allows apps to know when they are obscured by another window, such as when a notification modal appears.</td>
</tr>
<tr>
<td><a href="/docs/c/Foundation/Event_Service/CompassService/" title="CompassService" class="link--docs"><code>CompassService</code></a></td>
<td><a href="/docs/c/Foundation/Event_Service/CompassService/#CompassHeadingHandler" title="CompassHeadingHandler" class="link--docs"><code>CompassHeadingHandler</code></a></td>
<td>Allows apps to read a compass heading, including calibration status of the sensor.</td>
</tr>
</tbody></table>
<p>In addition, many other APIs also operate through the use of various callbacks
including <a href="/docs/c/User_Interface/Layers/MenuLayer/" title="MenuLayer" class="link--docs"><code>MenuLayer</code></a>, <a href="/docs/c/Foundation/AppMessage/" title="AppMessage" class="link--docs"><code>AppMessage</code></a>, <a href="/docs/c/Foundation/Timer/" title="Timer" class="link--docs"><code>Timer</code></a>, and <a href="/docs/c/Foundation/Wakeup/" title="Wakeup" class="link--docs"><code>Wakeup</code></a>, but these
are not considered to be &#39;event services&#39; in the same sense.</p><h2 id="using-event-services" class="anchor">Using Event Services</h2><p>The event services described in this guide are all used in the same manner - the
app subscribes an implementation of one or more handlers, and is notified by the
system when an event of that type occurs. In addition, most also include a
&#39;peek&#39; style API to read a single data item or status value on demand. This can
be useful to determine the initial service state when a watchapp starts. Apps
can subscribe to as many of these services as they require, and can also
unsubscribe at any time to stop receiving events.</p><p>Each event service is briefly discussed below with multiple snippets - handler
implementation example, subscribing to the service, and any &#39;peek&#39; API.</p><h3 id="tick-timer-service" class="anchor">Tick Timer Service</h3><p>The <a href="/docs/c/Foundation/Event_Service/TickTimerService/" title="TickTimerService" class="link--docs"><code>TickTimerService</code></a> allows an app to be notified when different units of
time change. This is decided based upon the <a href="/docs/c/Foundation/Event_Service/TickTimerService/#TimeUnits" title="TimeUnits" class="link--docs"><code>TimeUnits</code></a> value specified when a
subscription is added.</p><p>The <a href="http://www.cplusplus.com/reference/ctime/tm/" title="" class=""><code>struct tm</code></a> pointer provided
in the handler is a standard C object that contains many data fields describing
the current time. This can be used with
<a href="http://www.cplusplus.com/reference/ctime/strftime/" title="" class=""><code>strftime()</code></a> to obtain a
human-readable string.</p><div class="highlight"><pre><span class="k">static</span> <span class="kt">void</span> <span class="nf">tick_handler</span><span class="p">(</span><span class="k">struct</span> <span class="n">tm</span> <span class="o">*</span><span class="n">tick_time</span><span class="p">,</span> <span class="n">TimeUnits</span> <span class="n">changed</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">static</span> <span class="kt">char</span> <span class="n">s_buffer</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>

  <span class="c1">// Read time into a string buffer</span>
  <span class="n">strftime</span><span class="p">(</span><span class="n">s_buffer</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">s_buffer</span><span class="p">),</span> <span class="s">"%H:%M"</span><span class="p">,</span> <span class="n">tick_time</span><span class="p">);</span>

  <span class="n">APP_LOG</span><span class="p">(</span><span class="n">APP_LOG_LEVEL_INFO</span><span class="p">,</span> <span class="s">"Time is now %s"</span><span class="p">,</span> <span class="n">s_buffer</span><span class="p">);</span>
<span class="p">}</span>
</pre></div><div class="highlight"><pre><span class="c1">// Get updates when the current minute changes</span>
<span class="n">tick_timer_service_subscribe</span><span class="p">(</span><span class="n">MINUTE_UNIT</span><span class="p">,</span> <span class="n">tick_handler</span><span class="p">);</span>
</pre></div>
<blockquote>
<p>The <a href="/docs/c/Foundation/Event_Service/TickTimerService/" title="TickTimerService" class="link--docs"><code>TickTimerService</code></a> has no &#39;peek&#39; API, but a similar effect can be
achieved using the <a href="/docs/c/Standard_C/Time/" title="Time" class="link--docs"><code>time()</code></a> and <a href="/docs/c/Standard_C/Time/#localtime" title="localtime" class="link--docs"><code>localtime()</code></a> APIs.</p></blockquote>
<h3 id="connection-service" class="anchor">Connection Service</h3><p>The <a href="/docs/c/Foundation/Event_Service/ConnectionService/" title="ConnectionService" class="link--docs"><code>ConnectionService</code></a> uses a handler for each of two connection types:</p>
<ul>
<li><p><code>pebble_app_connection_handler</code> - the connection to the Pebble app on the
phone, analogous with the bluetooth connection state.</p></li>
<li><p><code>pebblekit_connection_handler</code> - the connection to an iOS companion app, if
applicable. Will never occur on Android.</p></li>
</ul>
<p>Either one is optional, but at least one must be specified for a valid
subscription.</p><div class="highlight"><pre><span class="k">static</span> <span class="kt">void</span> <span class="nf">app_connection_handler</span><span class="p">(</span><span class="kt">bool</span> <span class="n">connected</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">APP_LOG</span><span class="p">(</span><span class="n">APP_LOG_LEVEL_INFO</span><span class="p">,</span> <span class="s">"Pebble app %sconnected"</span><span class="p">,</span> <span class="n">connected</span> <span class="o">?</span> <span class="s">""</span> <span class="o">:</span> <span class="s">"dis"</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">kit_connection_handler</span><span class="p">(</span><span class="kt">bool</span> <span class="n">connected</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">APP_LOG</span><span class="p">(</span><span class="n">APP_LOG_LEVEL_INFO</span><span class="p">,</span> <span class="s">"PebbleKit %sconnected"</span><span class="p">,</span> <span class="n">connected</span> <span class="o">?</span> <span class="s">""</span> <span class="o">:</span> <span class="s">"dis"</span><span class="p">);</span>
<span class="p">}</span>
</pre></div><div class="highlight"><pre><span class="n">connection_service_subscribe</span><span class="p">((</span><span class="n">ConnectionHandlers</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">.</span><span class="n">pebble_app_connection_handler</span> <span class="o">=</span> <span class="n">app_connection_handler</span><span class="p">,</span>
  <span class="p">.</span><span class="n">pebblekit_connection_handler</span> <span class="o">=</span> <span class="n">kit_connection_handler</span>
<span class="p">});</span>
</pre></div><div class="highlight"><pre><span class="c1">// Peek at either the Pebble app or PebbleKit connections</span>
<span class="kt">bool</span> <span class="n">app_connection</span> <span class="o">=</span> <span class="n">connection_service_peek_pebble_app_connection</span><span class="p">();</span>
<span class="kt">bool</span> <span class="n">kit_connection</span> <span class="o">=</span> <span class="n">connection_service_peek_pebblekit_connection</span><span class="p">();</span>
</pre></div><h3 id="accelerometer-service" class="anchor">Accelerometer Service</h3><p>The <a href="/docs/c/Foundation/Event_Service/AccelerometerService/" title="AccelerometerService" class="link--docs"><code>AccelerometerService</code></a> can be used in two modes - tap events and raw data
events. <a href="/docs/c/Foundation/Event_Service/AccelerometerService/#AccelTapHandler" title="AccelTapHandler" class="link--docs"><code>AccelTapHandler</code></a> and <a href="/docs/c/Foundation/Event_Service/AccelerometerService/#AccelDataHandler" title="AccelDataHandler" class="link--docs"><code>AccelDataHandler</code></a> are used for each of these
respective use cases. See the
<a href="/guides/events-and-services/accelerometer/"><em>Accelerometer</em></a> guide for more
information.</p><p><strong>Data Events</strong></p><div class="highlight"><pre><span class="k">static</span> <span class="kt">void</span> <span class="nf">accel_data_handler</span><span class="p">(</span><span class="n">AccelData</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">num_samples</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">APP_LOG</span><span class="p">(</span><span class="n">APP_LOG_LEVEL_INFO</span><span class="p">,</span> <span class="s">"Got %d new samples"</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">num_samples</span><span class="p">);</span>
<span class="p">}</span>
</pre></div><div class="highlight"><pre><span class="k">const</span> <span class="kt">int</span> <span class="n">num_samples</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="c1">// Subscribe to data events</span>
<span class="n">accel_data_service_subscribe</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">accel_data_handler</span><span class="p">);</span>
</pre></div><div class="highlight"><pre><span class="c1">// Peek at the last reading</span>
<span class="n">AccelData</span> <span class="n">data</span><span class="p">;</span>
<span class="n">accel_service_peek</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">);</span>
</pre></div><p><strong>Tap Events</strong></p><div class="highlight"><pre><span class="k">static</span> <span class="kt">void</span> <span class="nf">accel_tap_handler</span><span class="p">(</span><span class="n">AccelAxisType</span> <span class="n">axis</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">direction</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">APP_LOG</span><span class="p">(</span><span class="n">APP_LOG_LEVEL_INFO</span><span class="p">,</span> <span class="s">"Tap event received"</span><span class="p">);</span>
<span class="p">}</span>
</pre></div><div class="highlight"><pre><span class="c1">// Subscribe to tap events</span>
<span class="n">accel_tap_service_subscribe</span><span class="p">(</span><span class="n">accel_tap_handler</span><span class="p">);</span>
</pre></div><h3 id="battery-state-service" class="anchor">Battery State Service</h3><p>The <a href="/docs/c/Foundation/Event_Service/BatteryStateService/" title="BatteryStateService" class="link--docs"><code>BatteryStateService</code></a> allows apps to examine the state of the battery, and
whether or not is is plugged in and charging.</p><div class="highlight"><pre><span class="k">static</span> <span class="kt">void</span> <span class="nf">battery_state_handler</span><span class="p">(</span><span class="n">BatteryChargeState</span> <span class="n">charge</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Report the current charge percentage</span>
  <span class="n">APP_LOG</span><span class="p">(</span><span class="n">APP_LOG_LEVEL_INFO</span><span class="p">,</span> <span class="s">"Battery charge is %d%%"</span><span class="p">,</span>
                                                    <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">charge</span><span class="p">.</span><span class="n">charge_percent</span><span class="p">);</span>
<span class="p">}</span>
</pre></div><div class="highlight"><pre><span class="c1">// Get battery state updates</span>
<span class="n">battery_state_service_subscribe</span><span class="p">(</span><span class="n">battery_state_handler</span><span class="p">);</span>
</pre></div><div class="highlight"><pre><span class="c1">// Peek at the current battery state</span>
<span class="n">BatteryChargeState</span> <span class="n">state</span> <span class="o">=</span> <span class="n">battery_state_service_peek</span><span class="p">();</span>
</pre></div><h3 id="health-service" class="anchor">Health Service</h3><p>The <a href="/docs/c/Foundation/Event_Service/HealthService/" title="HealthService" class="link--docs"><code>HealthService</code></a> uses the <a href="/docs/c/Foundation/Event_Service/HealthService/#HealthEventHandler" title="HealthEventHandler" class="link--docs"><code>HealthEventHandler</code></a> to notify a subscribed app
when new data pertaining to a <a href="/docs/c/Foundation/Event_Service/HealthService/#HealthMetric" title="HealthMetric" class="link--docs"><code>HealthMetric</code></a> is available. See the
<a href="/guides/events-and-services/health/"><em>Pebble Health</em></a> guide for more information.</p><div class="highlight"><pre><span class="k">static</span> <span class="kt">void</span> <span class="nf">health_handler</span><span class="p">(</span><span class="n">HealthEventType</span> <span class="n">event</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">context</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">event</span> <span class="o">==</span> <span class="n">HealthEventMovementUpdate</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">APP_LOG</span><span class="p">(</span><span class="n">APP_LOG_LEVEL_INFO</span><span class="p">,</span> <span class="s">"New health movement event"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div><div class="highlight"><pre><span class="c1">// Subscribe to health-related events</span>
<span class="n">health_service_events_subscribe</span><span class="p">(</span><span class="n">health_handler</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</pre></div><h3 id="app-focus-service" class="anchor">App Focus Service</h3><p>The <a href="/docs/c/Foundation/Event_Service/AppFocusService/" title="AppFocusService" class="link--docs"><code>AppFocusService</code></a> operates in two modes - basic and complete. </p><p><strong>Basic Subscription</strong></p><p>A basic subscription involves only one handler which will be fired when the app
is moved in or out of focus, and any animated transition has completed.</p><div class="highlight"><pre><span class="k">static</span> <span class="kt">void</span> <span class="nf">focus_handler</span><span class="p">(</span><span class="kt">bool</span> <span class="n">in_focus</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">APP_LOG</span><span class="p">(</span><span class="n">APP_LOG_LEVEL_INFO</span><span class="p">,</span> <span class="s">"App is %s in focus"</span><span class="p">,</span> <span class="n">in_focus</span> <span class="o">?</span> <span class="s">"now"</span> <span class="o">:</span> <span class="s">"not"</span><span class="p">);</span>
<span class="p">}</span>
</pre></div><div class="highlight"><pre><span class="c1">// Add a basic subscription</span>
<span class="n">app_focus_service_subscribe</span><span class="p">(</span><span class="n">focus_handler</span><span class="p">);</span>
</pre></div><p><strong>Complete Subscription</strong></p><p>A complete subscription will notify the app with more detail about changes in
focus using two handlers in an <a href="/docs/c/Foundation/Event_Service/AppFocusService/#AppFocusHandlers" title="AppFocusHandlers" class="link--docs"><code>AppFocusHandlers</code></a> object:</p>
<ul>
<li><p><code>.will_focus</code> - represents a change in focus that is <em>about</em> to occur, such as
the start of a transition animation to or from a modal window. <code>will_focus</code>
will be <code>true</code> if the app will be in focus at the end of the transition.</p></li>
<li><p><code>.did_focus</code> - represents the end of a transition. <code>did_focus</code> will be <code>true</code>
if the app is now completely in focus and the animation has finished.</p></li>
</ul>
<div class="highlight"><pre><span class="kt">void</span> <span class="nf">will_focus_handler</span><span class="p">(</span><span class="kt">bool</span> <span class="n">will_focus</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">APP_LOG</span><span class="p">(</span><span class="n">APP_LOG_LEVEL_INFO</span><span class="p">,</span> <span class="s">"Will %s focus"</span><span class="p">,</span> <span class="n">will_focus</span> <span class="o">?</span> <span class="s">"gain"</span> <span class="o">:</span> <span class="s">"lose"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">did_focus_handler</span><span class="p">(</span><span class="kt">bool</span> <span class="n">did_focus</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">APP_LOG</span><span class="p">(</span><span class="n">APP_LOG_LEVEL_INFO</span><span class="p">,</span> <span class="s">"%s focus"</span><span class="p">,</span> <span class="n">did_focus</span> <span class="o">?</span> <span class="s">"Gained"</span> <span class="o">:</span> <span class="s">"Lost"</span><span class="p">);</span>
<span class="p">}</span>
</pre></div><div class="highlight"><pre><span class="c1">// Subscribe to both types of events</span>
<span class="n">app_focus_service_subscribe_handlers</span><span class="p">((</span><span class="n">AppFocusHandlers</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">.</span><span class="n">will_focus</span> <span class="o">=</span> <span class="n">will_focus_handler</span><span class="p">,</span>
  <span class="p">.</span><span class="n">did_focus</span> <span class="o">=</span> <span class="n">did_focus_handler</span>
<span class="p">});</span>
</pre></div><h3 id="compass-service" class="anchor">Compass Service</h3><p>The <a href="/docs/c/Foundation/Event_Service/CompassService/" title="CompassService" class="link--docs"><code>CompassService</code></a> provides access to regular updates about the watch&#39;s
magnetic compass heading, if it is calibrated. See the
<a href="/guides/events-and-services/compass/"><em>Compass</em></a> guide for more information.</p><div class="highlight"><pre><span class="k">static</span> <span class="kt">void</span> <span class="nf">compass_heading_handler</span><span class="p">(</span><span class="n">CompassHeadingData</span> <span class="n">heading_data</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Is the compass calibrated?</span>
  <span class="k">if</span><span class="p">(</span><span class="n">heading_data</span><span class="p">.</span><span class="n">compass_status</span> <span class="o">==</span> <span class="n">CompassStatusCalibrated</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">APP_LOG</span><span class="p">(</span><span class="n">APP_LOG_LEVEL_INFO</span><span class="p">,</span> <span class="s">"Calibrated! Heading is %ld"</span><span class="p">,</span>
                             <span class="n">TRIGANGLE_TO_DEG</span><span class="p">(</span><span class="n">heading_data</span><span class="p">.</span><span class="n">magnetic_heading</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div><div class="highlight"><pre><span class="c1">// Subscribe to compass heading updates</span>
<span class="n">compass_service_subscribe</span><span class="p">(</span><span class="n">compass_heading_handler</span><span class="p">);</span>
</pre></div><div class="highlight"><pre><span class="c1">// Peek the compass heading data</span>
<span class="n">CompassHeadingData</span> <span class="n">data</span><span class="p">;</span>
<span class="n">compass_service_peek</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">);</span>
</pre></div>
    </div>

    <a id="comments" class="anchor"></a>
    <div id="disqus_thread" aria-live="polite" data-post-url="https://developer.getpebble.com/guides/events-and-services/events/">
      You need JavaScript enabled to read and post comments.
    </div>


  </div>

    <div class="col-m-4 hidden-s hidden-xs hidden-m">
      <div class="gray-box gray-box--fixed gray-box--scrollspy">

  <h3>Overview</h3>
  <ul class="toc">

      <li class="toc__item toc__item--level1"><a href="#types-of-events">Types of Events</a></li>

      <li class="toc__item toc__item--level1"><a href="#using-event-services">Using Event Services</a></li>

      <li class="toc__item toc__item--level2"><a href="#tick-timer-service">Tick Timer Service</a></li>

      <li class="toc__item toc__item--level2"><a href="#connection-service">Connection Service</a></li>

      <li class="toc__item toc__item--level2"><a href="#accelerometer-service">Accelerometer Service</a></li>

      <li class="toc__item toc__item--level2"><a href="#battery-state-service">Battery State Service</a></li>

      <li class="toc__item toc__item--level2"><a href="#health-service">Health Service</a></li>

      <li class="toc__item toc__item--level2"><a href="#app-focus-service">App Focus Service</a></li>

      <li class="toc__item toc__item--level2"><a href="#compass-service">Compass Service</a></li>

  </ul>


          <h3>Related SDK Docs</h3>
          <ul>

            <li><a href="/docs/c/Foundation/Event_Service/TickTimerService/">TickTimerService</a></li>

            <li><a href="/docs/c/Foundation/Event_Service/ConnectionService/">ConnectionService</a></li>

            <li><a href="/docs/c/Foundation/Event_Service/AccelerometerService/">AccelerometerService</a></li>

            <li><a href="/docs/c/Foundation/Event_Service/BatteryStateService/">BatteryStateService</a></li>

            <li><a href="/docs/c/Foundation/Event_Service/HealthService/">HealthService</a></li>

            <li><a href="/docs/c/Foundation/Event_Service/AppFocusService/">AppFocusService</a></li>

            <li><a href="/docs/c/Foundation/Event_Service/CompassService/">CompassService</a></li>

          </ul>


      </div>
    </div>

</div>

  </div>
</div>


  </div>
  <script type="text/javascript">
    var searchPrimary = '';
  </script>

  <script type="text/javascript" src="/developer.pebble.com/assets/js/libs-ce98da7b5eecc97f976a3cad8e665a31.js"></script>

  <script type="text/javascript" src="/developer.pebble.com/assets/js/templates.js"></script>
  <script type="text/javascript" src="/developer.pebble.com/assets/js/app.js"></script>
  <script type="text/javascript" src="/developer.pebble.com/assets/js/search.js"></script>
  <script type="text/javascript" src="/developer.pebble.com/assets/js/quicksearch.js"></script>
  <script type="text/javascript" src="/developer.pebble.com/assets/js/disqus.js"></script>

</body>
</html>
