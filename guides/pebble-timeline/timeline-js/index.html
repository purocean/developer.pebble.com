<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Managing Subscriptions // Pebble Developers</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="How to integrate the timeline into apps with the PebbleKit JS subscriptions
API according to user preferences.
">
  <link rel="canonical" href="http://developer.getpebble.com/guides/pebble-timeline/timeline-js/">
  <link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,400,300,600,700" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet" type="text/css">
  <link href="/developer.pebble.com/assets/favicon.png" rel="shortcut icon" type="image/vnd.microsoft.icon" id="favicon">
  <link rel="stylesheet" type="text/css" href="/developer.pebble.com/assets/css/main.css">

  <noscript>
  <link rel="stylesheet" type="text/css" href="/developer.pebble.com/assets/css/noscript.css">
  </noscript>

  <script type="text/javascript" >
    var _rollbarConfig = {
      accessToken: 'e1ecd52de5ba46c88e9f6f346a954c62',
      captureUncaught: true,
      payload: {
        environment: 'production'
      }
    };
    !function(a,b){function c(b){this.shimId=++h,this.notifier=null,this.parentShim=b,this.logger=function(){},a.console&&void 0===a.console.shimId&&(this.logger=a.console.log)}function d(b,c,d){a._rollbarWrappedError&&(d[4]||(d[4]=a._rollbarWrappedError),d[5]||(d[5]=a._rollbarWrappedError._rollbarContext),a._rollbarWrappedError=null),b.uncaughtError.apply(b,d),c&&c.apply(a,d)}function e(b){var d=c;return g(function(){if(this.notifier)return this.notifier[b].apply(this.notifier,arguments);var c=this,e="scope"===b;e&&(c=new d(this));var f=Array.prototype.slice.call(arguments,0),g={shim:c,method:b,args:f,ts:new Date};return a._rollbarShimQueue.push(g),e?c:void 0})}function f(a,b){if(b.hasOwnProperty&&b.hasOwnProperty("addEventListener")){var c=b.addEventListener;b.addEventListener=function(b,d,e){c.call(this,b,a.wrap(d),e)};var d=b.removeEventListener;b.removeEventListener=function(a,b,c){d.call(this,a,b&&b._wrapped?b._wrapped:b,c)}}}function g(a,b){return b=b||this.logger,function(){try{return a.apply(this,arguments)}catch(c){b("Rollbar internal error:",c)}}}var h=0;c.init=function(a,b){var e=b.globalAlias||"Rollbar";if("object"==typeof a[e])return a[e];a._rollbarShimQueue=[],a._rollbarWrappedError=null,b=b||{};var h=new c;return g(function(){if(h.configure(b),b.captureUncaught){var c=a.onerror;a.onerror=function(){var a=Array.prototype.slice.call(arguments,0);d(h,c,a)};var g,i,j="EventTarget,Window,Node,ApplicationCache,AudioTrackList,ChannelMergerNode,CryptoOperation,EventSource,FileReader,HTMLUnknownElement,IDBDatabase,IDBRequest,IDBTransaction,KeyOperation,MediaController,MessagePort,ModalWindow,Notification,SVGElementInstance,Screen,TextTrack,TextTrackCue,TextTrackList,WebSocket,WebSocketWorker,Worker,XMLHttpRequest,XMLHttpRequestEventTarget,XMLHttpRequestUpload".split(",");for(g=0;g<j.length;++g)i=j[g],a[i]&&a[i].prototype&&f(h,a[i].prototype)}return a[e]=h,h},h.logger)()},c.prototype.loadFull=function(a,b,c,d,e){var f=g(function(){var a=b.createElement("script"),e=b.getElementsByTagName("script")[0];a.src=d.rollbarJsUrl,a.async=!c,a.onload=h,e.parentNode.insertBefore(a,e)},this.logger),h=g(function(){var b;if(void 0===a._rollbarPayloadQueue){var c,d,f,g;for(b=new Error("rollbar.js did not load");c=a._rollbarShimQueue.shift();)for(f=c.args,g=0;g<f.length;++g)if(d=f[g],"function"==typeof d){d(b);break}}"function"==typeof e&&e(b)},this.logger);g(function(){c?f():a.addEventListener?a.addEventListener("load",f,!1):a.attachEvent("onload",f)},this.logger)()},c.prototype.wrap=function(b,c){try{var d;if(d="function"==typeof c?c:function(){return c||{}},"function"!=typeof b)return b;if(b._isWrap)return b;if(!b._wrapped){b._wrapped=function(){try{return b.apply(this,arguments)}catch(c){throw c._rollbarContext=d(),c._rollbarContext._wrappedSource=b.toString(),a._rollbarWrappedError=c,c}},b._wrapped._isWrap=!0;for(var e in b)b.hasOwnProperty(e)&&(b._wrapped[e]=b[e])}return b._wrapped}catch(f){return b}};for(var i="log,debug,info,warn,warning,error,critical,global,configure,scope,uncaughtError".split(","),j=0;j<i.length;++j)c.prototype[i[j]]=e(i[j]);var k="//d37gvrvc0wt4s1.cloudfront.net/js/v1.1/rollbar.min.js";_rollbarConfig.rollbarJsUrl=_rollbarConfig.rollbarJsUrl||k;var l=c.init(a,_rollbarConfig);l.loadFull(a,b,!1,_rollbarConfig)}(window,document);
  </script>
  <script type="text/javascript" async>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-30638158-4', 'auto');
    ga('send', 'pageview');
  </script>

</head>
<body class="">
  <div class="mmenu__wrapper">
    <div class="sidebar__wrapper sidebar__wrapper--sectionmenu">
  <div class="sidebar sidebar--narrow">
    <a href="/" class="sidebar__header">
      <span>pebble</span>
    </a>
    <ul class="mainmenu">
      <li class="mainmenu__item mainmenu__item--getting-started"><a href="/tutorials/"><span>Tutorials</span></a></li>
<li class="mainmenu__item mainmenu__item--sdk"><a href="/sdk/"><span>Get the SDK</span></a></li>
<li class="mainmenu__item mainmenu__item--guides active"><a href="/guides/"><span>Guides</span></a></li>
<li class="mainmenu__item mainmenu__item--docs"><a href="/docs/"><span>Documentation</span></a></li>
<li class="mainmenu__item mainmenu__item--examples"><a href="/examples/"><span>Examples</span></a></li>
<li class="mainmenu__item mainmenu__item--community"><a href="/community/"><span>Community</span></a></li>
<li class="mainmenu__item mainmenu__item--blog"><a href="/blog/"><span>Blog</span></a></li>
<li class="mainmenu__item mainmenu__item--more"><a href="/more/"><span>More</span></a></li>

    </ul>
    <div class="sidebar__legal">
      <a href="https://www.pebble.com/legal/privacy/" target="_blank">Privacy</a>
      <br>
      <a href="https://www.pebble.com/legal/cookies/" target="_blank">Cookies</a>
    </div>
    <a href="https://dev-portal.getpebble.com/" target="_blank" class="sidebar__footer">Publish</a>
  </div>
  <div class="section-menu section-menu--guides section-menu--light">
    <div class="section-menu__header">
      <h3><a href="/guides/">Guides</a></h3>
    </div>
    <ul>
      <li class="section-menu__item">
        <a href="/guides/toc/">Table of Contents</a>
      </li>




        <li class="section-menu__item">
          <a href="/guides/app-resources/">

            App Resources
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/appstore-publishing/">

            Appstore Publishing
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/best-practices/">

            Best Practices
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/communication/">

            Communication
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/debugging/">

            Debugging
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/design-and-interaction/">

            Design and Interaction
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/events-and-services/">

            Events and Services
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/graphics-and-animations/">

            Graphics and Animations
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/migration/">

            Migrating Older Apps
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/pebble-packages/">

            Pebble Packages
          </a>

        </li>




        <li class="section-menu__item open">
          <a href="/guides/pebble-timeline/">

            Pebble Timeline
          </a>

            <ul>




                <li class="section-menu__subitem">
                  <a href="/guides/pebble-timeline/pin-structure/"><span>Creating Pins</span></a>
                </li>



                <li class="section-menu__subitem">
                  <a href="/guides/pebble-timeline/timeline-libraries/"><span>Libraries for Pushing Pins</span></a>
                </li>



                <li class="section-menu__subitem active">
                  <a href="/guides/pebble-timeline/timeline-js/"><span>Managing Subscriptions</span></a>
                </li>





                <li class="section-menu__subitem">
                  <a href="/guides/pebble-timeline/timeline-public/"><span>Public Web API</span></a>
                </li>



                <li class="section-menu__subitem">
                  <a href="/guides/pebble-timeline/timeline-architecture/"><span>Service Architecture</span></a>
                </li>



            </ul>

        </li>




        <li class="section-menu__item">
          <a href="/guides/rocky-js/">

            Rocky.js
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/smartstraps/">

            Smartstraps
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/tools-and-resources/">

            Tools and Resources
          </a>

        </li>




        <li class="section-menu__item">
          <a href="/guides/user-interfaces/">

            User Interfaces
          </a>

        </li>

    </ul>
  </div>
</div><!-- sidebar__wrapper -->
<div class="content content--section-menu">
  <div class="search">
  <a  href="javascript:void(0);" class="mobile-nav__hamburger js-mobile-nav-toggle"><i class="fa fa-reorder"></i></a>
  <i class="fa fa-lg fa-search search__icon"></i><input type="search" id="quicksearch" placeholder="Search Developer Site">
</div>
<div class="quicksearch" style="display: none;" id="quicksearch__results"></div>
<div id="search__blackout" style="display: none;"></div>

  <div class="container">

<div class="visible-m visible-s visible-xs row">
  <div class="col-xs-12">
    <div class="form__group">
      <div class="select-style no-label">
        <select class="js-toc-select">

            <option value="requirements">Requirements</option>

            <option value="get-a-timeline-token">Get a Timeline Token</option>

            <option value="subscribe-to-a-topic">Subscribe to a Topic</option>

            <option value="unsubscribe-from-a-topic">Unsubscribe from a Topic</option>

            <option value="list-current-subscriptions">List Current Subscriptions</option>

        </select>
      </div>
    </div>
  </div>
</div>


<div class="row">
  <div class="col-l-8 col-m-12">
    <h1 class="pagetitle">Managing Subscriptions</h1>

<!--

 -->
    <div class="markdown markdown--staff">

    <p>The following PebbleKit JS APIs allow developers to intereact with the timeline
API, such as adding and removing the user&#39;s subscribed topics. By combining
these with user preferences from a configuration page (detailed in
<a href="/guides/user-interfaces/app-configuration/"><em>App Configuration</em></a>) it is possible to allow
users to choose which pin sources they receive updates and events from.</p>
<blockquote>
<p>The timeline APIs to subscribe users to topics and retrieve user tokens are
only available in PebbleKit JS.</p><p>If you wish to use the timeline APIs with a Pebble app that uses PebbleKit iOS
or Android please <a href="/contact" title="" class="">contact us</a> to discuss your specific use-case.</p></blockquote>
<h2 id="requirements" class="anchor">Requirements</h2><p>These APIs require some knowledge of your app before they can work. For example,
in order to return the user&#39;s timeline token, the web API must know your app&#39;s
UUID. This also ensures that only users who have your app installed will receive
the correct pins.</p><p>If you have not performed this process for your app and attempt to use these
APIs, you will receive an error similar to the following message:</p><div class="highlight"><pre>[INFO    ] No token available for this app and user.
</pre></div><h2 id="get-a-timeline-token" class="anchor">Get a Timeline Token</h2><p>The timeline token is unique for each user/app combination. This can be used by
an app&#39;s third party backend server to selectively send pins only to those users
who require them, or even to target users individually for complete
personalization.</p><div class="highlight"><pre><span class="nx">Pebble</span><span class="p">.</span><span class="nx">getTimelineToken</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'My timeline token is '</span> <span class="o">+</span> <span class="nx">token</span><span class="p">);</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Error getting timeline token: '</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
<span class="p">});</span>
</pre></div><h2 id="subscribe-to-a-topic" class="anchor">Subscribe to a Topic</h2><p>A user can also subscribe to a specific topic in each app. Every user that
subscribes to this topic will receive the pins pushed to it. This can be used to
let the user choose which features of your app they wish to subscribe to. For
example, they may want &#39;world news&#39; stories but not &#39;technology&#39; stories. In
this case they would be subscribed only to the topic that includes pins with
&#39;world news&#39; information.</p><div class="highlight"><pre><span class="nx">Pebble</span><span class="p">.</span><span class="nx">timelineSubscribe</span><span class="p">(</span><span class="s1">'world-news'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Subscribed to world-news'</span><span class="p">);</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Error subscribing to topic: '</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
<span class="p">});</span>
</pre></div><h2 id="unsubscribe-from-a-topic" class="anchor">Unsubscribe from a Topic</h2><p>The user may unsubscribe from a topic they previously subscribed to. They will
no longer receive pins from this topic.</p><div class="highlight"><pre><span class="nx">Pebble</span><span class="p">.</span><span class="nx">timelineUnsubscribe</span><span class="p">(</span><span class="s1">'world-news'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Unsubscribed from world-news'</span><span class="p">);</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Error unsubscribing from topic: '</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
<span class="p">});</span>
</pre></div><h2 id="list-current-subscriptions" class="anchor">List Current Subscriptions</h2><p>You can use the function below to list all the topics a user has subscribed to.</p><div class="highlight"><pre><span class="nx">Pebble</span><span class="p">.</span><span class="nx">timelineSubscriptions</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">topics</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// List all the subscribed topics</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Subscribed to '</span> <span class="o">+</span> <span class="nx">topics</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">', '</span><span class="p">));</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">errorString</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Error getting subscriptions: '</span> <span class="o">+</span> <span class="nx">errorString</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
    </div>

    <a id="comments" class="anchor"></a>
    <div id="disqus_thread" aria-live="polite" data-post-url="https://developer.getpebble.com/guides/pebble-timeline/timeline-js/">
      You need JavaScript enabled to read and post comments.
    </div>


  </div>

    <div class="col-m-4 hidden-s hidden-xs hidden-m">
      <div class="gray-box gray-box--fixed gray-box--scrollspy">

  <h3>Overview</h3>
  <ul class="toc">

      <li class="toc__item toc__item--level1"><a href="#requirements">Requirements</a></li>

      <li class="toc__item toc__item--level1"><a href="#get-a-timeline-token">Get a Timeline Token</a></li>

      <li class="toc__item toc__item--level1"><a href="#subscribe-to-a-topic">Subscribe to a Topic</a></li>

      <li class="toc__item toc__item--level1"><a href="#unsubscribe-from-a-topic">Unsubscribe from a Topic</a></li>

      <li class="toc__item toc__item--level1"><a href="#list-current-subscriptions">List Current Subscriptions</a></li>

  </ul>



          <h3>Examples</h3>
          <ul>

            <li><a href="https://github.com/pebble-examples/timeline-push-pin" target="_blank">Timeline Push Pin</a></li>

            <li><a href="https://github.com/pebble-examples/hello-timeline" target="_blank">Hello Timeline</a></li>

            <li><a href="https://github.com/pebble-examples/timeline-tv-tracker" target="_blank">Timeline TV Tracker</a></li>

          </ul>

      </div>
    </div>

</div>

  </div>
</div>


  </div>
  <script type="text/javascript">
    var searchPrimary = '';
  </script>

  <script type="text/javascript" src="/developer.pebble.com/assets/js/libs-ce98da7b5eecc97f976a3cad8e665a31.js"></script>

  <script type="text/javascript" src="/developer.pebble.com/assets/js/templates.js"></script>
  <script type="text/javascript" src="/developer.pebble.com/assets/js/app.js"></script>
  <script type="text/javascript" src="/developer.pebble.com/assets/js/search.js"></script>
  <script type="text/javascript" src="/developer.pebble.com/assets/js/quicksearch.js"></script>
  <script type="text/javascript" src="/developer.pebble.com/assets/js/disqus.js"></script>

</body>
</html>
