<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>SDK 3.x on Aplite Migration Guide // Pebble Developers</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="How to migrate apps that use SDK 2.x on Aplite to SDK 3.x">
  <link rel="canonical" href="http://developer.getpebble.com/guides/migration/3x-aplite-migration/">
  <link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,400,300,600,700" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet" type="text/css">
  <link href="/assets/favicon.png" rel="shortcut icon" type="image/vnd.microsoft.icon" id="favicon">
  <link rel="stylesheet" type="text/css" href="/assets/css/main.css">
  
  <noscript>
  <link rel="stylesheet" type="text/css" href="/assets/css/noscript.css">
  </noscript>
  
  <script type="text/javascript" >
    var _rollbarConfig = {
      accessToken: 'e1ecd52de5ba46c88e9f6f346a954c62',
      captureUncaught: true,
      payload: {
        environment: 'production'
      }
    };
    !function(a,b){function c(b){this.shimId=++h,this.notifier=null,this.parentShim=b,this.logger=function(){},a.console&&void 0===a.console.shimId&&(this.logger=a.console.log)}function d(b,c,d){a._rollbarWrappedError&&(d[4]||(d[4]=a._rollbarWrappedError),d[5]||(d[5]=a._rollbarWrappedError._rollbarContext),a._rollbarWrappedError=null),b.uncaughtError.apply(b,d),c&&c.apply(a,d)}function e(b){var d=c;return g(function(){if(this.notifier)return this.notifier[b].apply(this.notifier,arguments);var c=this,e="scope"===b;e&&(c=new d(this));var f=Array.prototype.slice.call(arguments,0),g={shim:c,method:b,args:f,ts:new Date};return a._rollbarShimQueue.push(g),e?c:void 0})}function f(a,b){if(b.hasOwnProperty&&b.hasOwnProperty("addEventListener")){var c=b.addEventListener;b.addEventListener=function(b,d,e){c.call(this,b,a.wrap(d),e)};var d=b.removeEventListener;b.removeEventListener=function(a,b,c){d.call(this,a,b&&b._wrapped?b._wrapped:b,c)}}}function g(a,b){return b=b||this.logger,function(){try{return a.apply(this,arguments)}catch(c){b("Rollbar internal error:",c)}}}var h=0;c.init=function(a,b){var e=b.globalAlias||"Rollbar";if("object"==typeof a[e])return a[e];a._rollbarShimQueue=[],a._rollbarWrappedError=null,b=b||{};var h=new c;return g(function(){if(h.configure(b),b.captureUncaught){var c=a.onerror;a.onerror=function(){var a=Array.prototype.slice.call(arguments,0);d(h,c,a)};var g,i,j="EventTarget,Window,Node,ApplicationCache,AudioTrackList,ChannelMergerNode,CryptoOperation,EventSource,FileReader,HTMLUnknownElement,IDBDatabase,IDBRequest,IDBTransaction,KeyOperation,MediaController,MessagePort,ModalWindow,Notification,SVGElementInstance,Screen,TextTrack,TextTrackCue,TextTrackList,WebSocket,WebSocketWorker,Worker,XMLHttpRequest,XMLHttpRequestEventTarget,XMLHttpRequestUpload".split(",");for(g=0;g<j.length;++g)i=j[g],a[i]&&a[i].prototype&&f(h,a[i].prototype)}return a[e]=h,h},h.logger)()},c.prototype.loadFull=function(a,b,c,d,e){var f=g(function(){var a=b.createElement("script"),e=b.getElementsByTagName("script")[0];a.src=d.rollbarJsUrl,a.async=!c,a.onload=h,e.parentNode.insertBefore(a,e)},this.logger),h=g(function(){var b;if(void 0===a._rollbarPayloadQueue){var c,d,f,g;for(b=new Error("rollbar.js did not load");c=a._rollbarShimQueue.shift();)for(f=c.args,g=0;g<f.length;++g)if(d=f[g],"function"==typeof d){d(b);break}}"function"==typeof e&&e(b)},this.logger);g(function(){c?f():a.addEventListener?a.addEventListener("load",f,!1):a.attachEvent("onload",f)},this.logger)()},c.prototype.wrap=function(b,c){try{var d;if(d="function"==typeof c?c:function(){return c||{}},"function"!=typeof b)return b;if(b._isWrap)return b;if(!b._wrapped){b._wrapped=function(){try{return b.apply(this,arguments)}catch(c){throw c._rollbarContext=d(),c._rollbarContext._wrappedSource=b.toString(),a._rollbarWrappedError=c,c}},b._wrapped._isWrap=!0;for(var e in b)b.hasOwnProperty(e)&&(b._wrapped[e]=b[e])}return b._wrapped}catch(f){return b}};for(var i="log,debug,info,warn,warning,error,critical,global,configure,scope,uncaughtError".split(","),j=0;j<i.length;++j)c.prototype[i[j]]=e(i[j]);var k="//d37gvrvc0wt4s1.cloudfront.net/js/v1.1/rollbar.min.js";_rollbarConfig.rollbarJsUrl=_rollbarConfig.rollbarJsUrl||k;var l=c.init(a,_rollbarConfig);l.loadFull(a,b,!1,_rollbarConfig)}(window,document);
  </script>
  <script type="text/javascript" async>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-30638158-4', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>
<body class="">
  <div class="mmenu__wrapper">
    <div class="sidebar__wrapper sidebar__wrapper--sectionmenu">
  <div class="sidebar sidebar--narrow">
    <a href="/" class="sidebar__header">
      <span>pebble</span>
    </a>
    <ul class="mainmenu">
      <li class="mainmenu__item mainmenu__item--getting-started"><a href="/tutorials/"><span>Tutorials</span></a></li>
<li class="mainmenu__item mainmenu__item--sdk"><a href="/sdk/"><span>Get the SDK</span></a></li>
<li class="mainmenu__item mainmenu__item--guides active"><a href="/guides/"><span>Guides</span></a></li>
<li class="mainmenu__item mainmenu__item--docs"><a href="/docs/"><span>Documentation</span></a></li>
<li class="mainmenu__item mainmenu__item--examples"><a href="/examples/"><span>Examples</span></a></li>
<li class="mainmenu__item mainmenu__item--community"><a href="/community/"><span>Community</span></a></li>
<li class="mainmenu__item mainmenu__item--blog"><a href="/blog/"><span>Blog</span></a></li>
<li class="mainmenu__item mainmenu__item--more"><a href="/more/"><span>More</span></a></li>

    </ul>
    <div class="sidebar__legal">
      <a href="https://www.pebble.com/legal/privacy/" target="_blank">Privacy</a>
      <br>
      <a href="https://www.pebble.com/legal/cookies/" target="_blank">Cookies</a>
    </div>
    <a href="https://dev-portal.getpebble.com/" target="_blank" class="sidebar__footer">Publish</a>
  </div>
  <div class="section-menu section-menu--guides section-menu--light">
    <div class="section-menu__header">
      <h3><a href="/guides/">Guides</a></h3>
    </div>
    <ul>
      <li class="section-menu__item">
        <a href="/guides/toc/">Table of Contents</a>
      </li>
      
        
        
        
        <li class="section-menu__item">
          <a href="/guides/app-resources/">
            
            App Resources
          </a>
          
        </li>
      
        
        
        
        <li class="section-menu__item">
          <a href="/guides/appstore-publishing/">
            
            Appstore Publishing
          </a>
          
        </li>
      
        
        
        
        <li class="section-menu__item">
          <a href="/guides/best-practices/">
            
            Best Practices
          </a>
          
        </li>
      
        
        
        
        <li class="section-menu__item">
          <a href="/guides/communication/">
            
            Communication
          </a>
          
        </li>
      
        
        
        
        <li class="section-menu__item">
          <a href="/guides/debugging/">
            
            Debugging
          </a>
          
        </li>
      
        
        
        
        <li class="section-menu__item">
          <a href="/guides/design-and-interaction/">
            
            Design and Interaction
          </a>
          
        </li>
      
        
        
        
        <li class="section-menu__item">
          <a href="/guides/events-and-services/">
            
            Events and Services
          </a>
          
        </li>
      
        
        
        
        <li class="section-menu__item">
          <a href="/guides/graphics-and-animations/">
            
            Graphics and Animations
          </a>
          
        </li>
      
        
        
        
        <li class="section-menu__item open">
          <a href="/guides/migration/">
            
            Migrating Older Apps
          </a>
          
            <ul>
            
            
            
              
            
              
                <li class="section-menu__subitem">
                  <a href="/guides/migration/pebblekit-ios-3/"><span>PebbleKit iOS 3.0 Migration Guide</span></a>
                </li>
              
            
              
                <li class="section-menu__subitem">
                  <a href="/guides/migration/migration-guide/"><span>SDK 2.x Migration Guide</span></a>
                </li>
              
            
              
                <li class="section-menu__subitem">
                  <a href="/guides/migration/migration-guide-3/"><span>SDK 3.x Migration Guide</span></a>
                </li>
              
            
              
                <li class="section-menu__subitem active">
                  <a href="/guides/migration/3x-aplite-migration/"><span>SDK 3.x on Aplite Migration Guide</span></a>
                </li>
              
            
              
                <li class="section-menu__subitem">
                  <a href="/guides/migration/migration-guide-4/"><span>SDK 4.x Migration Guide</span></a>
                </li>
              
            
            
            </ul>
          
        </li>
      
        
        
        
        <li class="section-menu__item">
          <a href="/guides/pebble-packages/">
            
            Pebble Packages
          </a>
          
        </li>
      
        
        
        
        <li class="section-menu__item">
          <a href="/guides/pebble-timeline/">
            
            Pebble Timeline
          </a>
          
        </li>
      
        
        
        
        <li class="section-menu__item">
          <a href="/guides/rocky-js/">
            
            Rocky.js
          </a>
          
        </li>
      
        
        
        
        <li class="section-menu__item">
          <a href="/guides/smartstraps/">
            
            Smartstraps
          </a>
          
        </li>
      
        
        
        
        <li class="section-menu__item">
          <a href="/guides/tools-and-resources/">
            
            Tools and Resources
          </a>
          
        </li>
      
        
        
        
        <li class="section-menu__item">
          <a href="/guides/user-interfaces/">
            
            User Interfaces
          </a>
          
        </li>
      
    </ul>
  </div>
</div><!-- sidebar__wrapper -->
<div class="content content--section-menu">
  <div class="search">
  <a  href="javascript:void(0);" class="mobile-nav__hamburger js-mobile-nav-toggle"><i class="fa fa-reorder"></i></a>
  <i class="fa fa-lg fa-search search__icon"></i><input type="search" id="quicksearch" placeholder="Search Developer Site">
</div>
<div class="quicksearch" style="display: none;" id="quicksearch__results"></div>
<div id="search__blackout" style="display: none;"></div>

  <div class="container">
    
<div class="visible-m visible-s visible-xs row">
  <div class="col-xs-12">
    <div class="form__group">
      <div class="select-style no-label">
        <select class="js-toc-select">
          
            <option value="get-the-beta-sdk">Get the Beta SDK</option>
          
            <option value="mandatory-changes">Mandatory Changes</option>
          
            <option value="appstore-changes">Appstore Changes</option>
          
            <option value="suggested-changes">Suggested Changes</option>
          
        </select>
      </div>
    </div>
  </div>
</div>


<div class="row">
  <div class="col-l-8 col-m-12">
    <h1 class="pagetitle">SDK 3.x on Aplite Migration Guide</h1>
    
<!-- 
    
 -->
    <div class="markdown markdown--staff">
    
    <p>With the release of SDK 3.8, all Pebble platforms can be targeted with one SDK.
This enables developers to make use of lots of new APIs added since SDK 2.9, as
well as the countless bug fixes and improvements also added in the intervening
time. Some examples are:</p>
<ul>
<li><p>Timezone support</p></li>
<li><p>Sequence and spawn animations</p></li>
<li><p>Pebble timeline support</p></li>
<li><p>Pebble Draw Commands</p></li>
<li><p>Native PNG image support</p></li>
<li><p>8k <code>AppMessage</code> buffers</p></li>
<li><p>New UI components such as <code>ActionMenu</code>, <code>StatusBarLayer</code>, and
<code>ContentIndicator</code>.</p></li>
<li><p>The stroke width, drawing arcs, polar points APIs, and the color gray!</p></li>
</ul>
<h2 id="get-the-beta-sdk" class="anchor">Get the Beta SDK</h2><p>To try out the beta SDK, read the instructions on the <a href="/sdk/beta" title="" class="">SDK Beta</a>
page.</p><h2 id="mandatory-changes" class="anchor">Mandatory Changes</h2><p>To be compatible with users who update their Pebble Classic or Pebble Steel to
firmware 3.x the following important changes <strong>MUST</strong> be made:</p>
<ul>
<li><p>If you are adding support for Aplite, add <code>aplite</code> to your <code>targetPlatforms</code>
array in <code>package.json</code>, or tick the &#39;Build Aplite&#39; box in &#39;Settings&#39; on
CloudPebble.</p></li>
<li><p>Recompile your app with at least Pebble SDK 3.8 (coming soon!). The 3.x on
Aplite files will reside in <code>/aplite/</code> instead of the <code>.pbw</code> root folder.
Frankenpbws are <strong>not</strong> encouraged - a 2.x compatible release can be uploaded
separately (see <a href="#appstore-changes" title="" class=""><em>Appstore Changes</em></a>).</p></li>
<li><p>Update any old practices such as direct struct member access. An example is
shown below:</p><div class="highlight"><pre><span class="c1">// 2.x - don't do this!</span>
<span class="n">GRect</span> <span class="n">bitmap_bounds</span> <span class="o">=</span> <span class="n">s_bitmap</span><span class="o">-&gt;</span><span class="n">bounds</span><span class="p">;</span>

<span class="c1">// 3.x - please do this!</span>
<span class="n">GRect</span> <span class="n">bitmap_bounds</span> <span class="o">=</span> <span class="n">gbitmap_get_bounds</span><span class="p">(</span><span class="n">s_bitmap</span><span class="p">);</span>
</pre></div></li>
<li><p>Apps that make use of the <code>png-trans</code> resource type should now make use of
built-in PNG support, which allows a single black and white image with
transparency to be used in place of the older compositing technique.</p></li>
<li><p>If your app uses either the <a href="/docs/c/Foundation/Dictation/" title="Dictation" class="link--docs"><code>Dictation</code></a> or <a href="/docs/c/Smartstrap/" title="Smartstrap" class="link--docs"><code>Smartstrap</code></a> APIs, you must
check that any code dependant on these hardware features fails gracefully when
they are not available. This should be done by checking for <code>NULL</code> or
appropriate <code>enum</code> values returned from affected API calls. An example is
shown below:</p><div class="highlight"><pre><span class="k">if</span><span class="p">(</span><span class="n">smartstrap_subscribe</span><span class="p">(</span><span class="n">handlers</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SmartstrapResultNotPresent</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// OK to use Smartstrap API!</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="c1">// Not available, handle gracefully</span>
  <span class="n">text_layer_set_text</span><span class="p">(</span><span class="n">s_text_layer</span><span class="p">,</span> <span class="s">"Smartstrap not available!"</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">DictationSession</span> <span class="o">*</span><span class="n">session</span> <span class="o">=</span> <span class="n">dictation_session_create</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// OK to use Dictation API!</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="c1">// Not available, handle gracefully</span>
  <span class="n">text_layer_set_text</span><span class="p">(</span><span class="n">s_text_layer</span><span class="p">,</span> <span class="s">"Dictation not available!"</span><span class="p">);</span>
<span class="p">}</span>
</pre></div></li>
</ul>
<h2 id="appstore-changes" class="anchor">Appstore Changes</h2><p>To handle the transition as users update their Aplite to firmware 3.x (or choose
not to), the appstore will include the following changes:</p>
<ul>
<li><p>You can now have multiple published releases. When you publish a new release,
it doesn’t unpublish the previous one. You can still manually unpublish
releases whenever they want.</p></li>
<li><p>The appstore will provide the most recently compatible release of an app to
users. This means that if you publish a new release that has 3.x Aplite
support, the newest published release that supports 2.x Aplite will be
provided to users on 2.x Aplite.</p></li>
<li><p>There will be a fourth Asset Collection type that you can create: Legacy
Aplite. Apps that have different UI designs between 2.x and 3.x on Aplite
should use the Legacy Aplite asset collection for their 2.x assets.</p></li>
</ul>
<h2 id="suggested-changes" class="anchor">Suggested Changes</h2><p>To fully migrate to SDK 3.x, we also suggest you make these nonessential
changes:</p>
<ul>
<li><p>Remove any code conditionally compiled with <code>PBL_SDK_2</code> defines. It will no
longer be compiled at all.</p></li>
<li><p>Ensure that any use of <a href="/docs/c/Foundation/AppMessage/#app_message_inbox_size_maximum" title="app_message_inbox_size_maximum" class="link--docs"><code>app_message_inbox_size_maximum()</code></a> and
<a href="/docs/c/Foundation/AppMessage/#app_message_outbox_size_maximum" title="app_message_outbox_size_maximum" class="link--docs"><code>app_message_outbox_size_maximum()</code></a> does not cause your app to run out of
memory. These calls now create <a href="/docs/c/Foundation/AppMessage/" title="AppMessage" class="link--docs"><code>AppMessage</code></a> buffers of 8k size by default.
Aplite apps limited to 24k of RAM will quickly run out if they use much more
memory.</p></li>
<li><p>Colors not available on the black and white Aplite display will be silently
displayed as the closet match (black, or white). We recommend checking every
instance of a <code>GColor</code>to ensure each is the correct one. <code>GColorDarkGray</code> and
<code>GColorLightGray</code> will result in a 50/50 dithered gray for <strong>fill</strong>
operations. All other line and text drawing will be mapped to the nearest
solid color (black or white).</p></li>
<li><p>Apps using image resources should take advantage of the new <code>bitmap</code> resource
type, which optimizes image files for you. Read the
<a href="/blog/2015/12/02/Bitmap-Resources/" title="" class=""><em>Unifying Bitmap Resources</em></a>
blog post to learn more.</p></li>
<li><p>In addition to the point above, investigate how the contrast and readability
of your app can be improved by making use of gray. Examples of this can be
seen in the system UI:</p></li>
</ul>
<p><img src="/assets/images/guides/migration/3x-aplite-system.png" alt="3x-aplite-system" class="pebble-screenshot pebble-screenshot--black" /></p>
    </div>
    
    <a id="comments" class="anchor"></a>
    <div id="disqus_thread" aria-live="polite" data-post-url="https://developer.getpebble.com/guides/migration/3x-aplite-migration/">
      You need JavaScript enabled to read and post comments.
    </div>
    
    
  </div>
  
    <div class="col-m-4 hidden-s hidden-xs hidden-m">
      <div class="gray-box gray-box--fixed gray-box--scrollspy">
        
  <h3>Overview</h3>
  <ul class="toc">
    
      <li class="toc__item toc__item--level1"><a href="#get-the-beta-sdk">Get the Beta SDK</a></li>
    
      <li class="toc__item toc__item--level1"><a href="#mandatory-changes">Mandatory Changes</a></li>
    
      <li class="toc__item toc__item--level1"><a href="#appstore-changes">Appstore Changes</a></li>
    
      <li class="toc__item toc__item--level1"><a href="#suggested-changes">Suggested Changes</a></li>
    
  </ul>

        
        
      </div>
    </div>
  
</div>

  </div>
</div>

    
  </div>
  <script type="text/javascript">
    var searchPrimary = '';
  </script>
  
  <script type="text/javascript" src="/assets/js/libs-ce98da7b5eecc97f976a3cad8e665a31.js"></script>
  
  <script type="text/javascript" src="/assets/js/templates.js"></script>
  <script type="text/javascript" src="/assets/js/app.js"></script>
  <script type="text/javascript" src="/assets/js/search.js"></script>
  <script type="text/javascript" src="/assets/js/quicksearch.js"></script>
  <script type="text/javascript" src="/assets/js/disqus.js"></script>
  
</body>
</html>
